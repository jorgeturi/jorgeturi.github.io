<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Validator</title>
  <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-storage.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDDwoPMT1AeemByzRwuXGE2qnPNYmW5Pmg",
      authDomain: "finalpoo-turinajorge.firebaseapp.com",
      projectId: "finalpoo-turinajorge",
      storageBucket: "finalpoo-turinajorge.appspot.com",
      messagingSenderId: "929827470228",
      appId: "1:929827470228:web:03a6a7a934d4e19caa2d81",
      measurementId: "G-B3M3SP1SKF"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
</head>
<body>
  <h1>QR Code Validator</h1>
  
  <div id="qrResult">
    <p>QR Code Scan Result:</p>
    <p id="qrStatus">Scan a QR code to validate</p>
  </div>

  <script>
    // Función para validar el QR
    function validateQRCode(qrCode) {
      const db = firebase.firestore();
      const qrRef = db.collection('qrs').doc(qrCode);  // Usando el ID del QR

      qrRef.get().then((doc) => {
        if (doc.exists) {
          const data = doc.data();
          const expirationDate = new Date(data.fechaExpiracion.seconds * 1000);  // Convertimos el timestamp de Firestore
          const currentDate = new Date();
          
          if (expirationDate > currentDate) {
            document.getElementById('qrStatus').innerText = "QR is valid!";
          } else {
            document.getElementById('qrStatus').innerText = "QR has expired!";
          }
        } else {
          document.getElementById('qrStatus').innerText = "QR not found!";
        }
      }).catch((error) => {
        console.error("Error fetching document: ", error);
        document.getElementById('qrStatus').innerText = "Error validating QR.";
      });
    }

    // Simulación de escaneo del QR
    const scannedQRCode = 'google.com|2025-01-15T18:51:37.820210|gugul vencimiento|2025-01-15T18:49:37.820403|JyUgol0In9T6KyCWUKXDqSMPl4y1|2025-01-15T18:51:37.820210';
    const qrParts = scannedQRCode.split('|');
    const url = qrParts[0];  // Utilizando la URL del QR
    validateQRCode(url);  // Pasamos la URL como ID al Firestore
  </script>
</body>
</html>

